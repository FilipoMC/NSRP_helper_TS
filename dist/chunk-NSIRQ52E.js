/* Optimized production build generated by CommandKit */
import {
  partnership_ticket_default
} from "./chunk-VCBZIZQ4.js";
import {
  __name
} from "./chunk-4HQ2LG3N.js";

// src/api/tickets/new-ticket.ts
var TICKETS_TOKEN = process.env.EXPRESS_TICKETS_TOKEN;
async function new_ticket_default(client, app) {
  app.post("/tickets/new-ticket", async (req, res) => {
    try {
      if (req.headers.authorization !== TICKETS_TOKEN) {
        res.status(403).send({});
        return;
      }
      if (!client.isReady()) {
        res.status(403).send({});
        return;
      }
      const body = req.body;
      const ticketChannel = await client.channels.fetch(body.ticket_channel_id);
      if (!body.is_new_ticket) {
        res.status(400).send({});
        return;
      }
      if (!ticketChannel || !ticketChannel.isThread()) {
        res.status(400).send({});
        return;
      }
      if (ticketChannel.name.startsWith("ticket-p")) {
        partnership_ticket_default(client, ticketChannel);
        res.status(200).send({});
        return;
      }
      res.status(404).send({});
    } catch (e) {
      res.status(500).send({});
    }
  });
}
__name(new_ticket_default, "default");

export {
  new_ticket_default
};
